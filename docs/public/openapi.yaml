openapi: 3.0.3
info:
  title: OpenRedaction API
  description: |
    OpenRedaction is an open-source PII (Personally Identifiable Information) detection and redaction library with optional AI assist.
    
    This API provides AI-powered PII detection on top of regex patterns for better detection on messy or unstructured text.
    
    ## Authentication
    
    API keys are optional for free tier usage (IP-based rate limiting). For Pro tier access with higher limits, include your API key in the `x-api-key` header.
    
    ## Rate Limits
    
    - **Free Tier**: IP-based rate limiting (fair-use limits)
    - **Pro Tier**: 50,000 AI-assist requests per month with API key
    
    ## Privacy
    
    - Stateless processing - no data is stored
    - No logging of input text
    - Data is processed in memory and discarded immediately
  version: 1.0.0
  contact:
    name: OpenRedaction Support
    url: https://openredaction.com/contact
  license:
    name: MIT
    url: https://github.com/sam247/openredaction/blob/main/LICENSE

servers:
  - url: https://openredaction-api.onrender.com
    description: Production server

paths:
  /v1/ai-detect:
    post:
      summary: Detect PII in text using AI assist
      description: |
        Detects PII entities in the provided text using AI-powered detection.
        Returns detected entities with their types, positions, and values.
        
        **Note**: This endpoint requires AI assist. For regex-only detection, use the npm library.
      operationId: detectPII
      tags:
        - Detection
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DetectionRequest'
            examples:
              basic:
                summary: Basic request
                value:
                  text: "Contact John Doe at john@example.com or call 555-123-4567"
              long_text:
                summary: Long text example
                value:
                  text: "My name is Sarah Johnson and I live at 123 Main Street, London. You can reach me at sarah.johnson@email.com or on my mobile phone 07700 900123. My date of birth is 15/03/1985."
      responses:
        '200':
          description: Successful detection
          headers:
            X-Usage-Count:
              description: Current usage count for this billing period
              schema:
                type: integer
                example: 1234
            X-Usage-Limit:
              description: Monthly usage limit
              schema:
                type: integer
                example: 50000
            X-Usage-Reset:
              description: ISO 8601 timestamp when usage resets
              schema:
                type: string
                format: date-time
                example: "2025-01-01T00:00:00Z"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DetectionResponse'
              examples:
                success:
                  summary: Successful detection
                  value:
                    entities:
                      - type: "PERSON"
                        value: "John Doe"
                        start: 8
                        end: 16
                      - type: "EMAIL"
                        value: "john@example.com"
                        start: 21
                        end: 37
                      - type: "PHONE"
                        value: "555-123-4567"
                        start: 41
                        end: 53
                    aiUsed: true
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '503':
          $ref: '#/components/responses/ServiceUnavailable'

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key
      description: API key for Pro tier access (optional for free tier)

  schemas:
    DetectionRequest:
      type: object
      required:
        - text
      properties:
        text:
          type: string
          description: Text to analyze for PII
          minLength: 1
          maxLength: 50000
          example: "Contact John Doe at john@example.com or call 555-123-4567"
      additionalProperties: false

    Entity:
      type: object
      required:
        - type
        - value
        - start
        - end
      properties:
        type:
          type: string
          description: Type of PII entity detected
          enum:
            - PERSON
            - EMAIL
            - PHONE
            - IP_ADDRESS
            - CREDIT_CARD
            - SSN
            - DATE_OF_BIRTH
            - ADDRESS
            - PASSPORT
            - DRIVER_LICENSE
            - ORGANIZATION
            - LOCATION
          example: "EMAIL"
        value:
          type: string
          description: The detected PII value
          example: "john@example.com"
        start:
          type: integer
          description: Start position of the entity in the text (0-indexed)
          minimum: 0
          example: 21
        end:
          type: integer
          description: End position of the entity in the text (0-indexed)
          minimum: 0
          example: 37

    DetectionResponse:
      type: object
      required:
        - entities
        - aiUsed
      properties:
        entities:
          type: array
          description: Array of detected PII entities
          items:
            $ref: '#/components/schemas/Entity'
        aiUsed:
          type: boolean
          description: Whether AI assist was used for detection
          example: true

    Error:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          description: Error code
          example: "INVALID_KEY"
        message:
          type: string
          description: Human-readable error message
          example: "Invalid or missing API key"
        details:
          type: string
          description: Additional error details (optional)
          example: "The provided API key is invalid or has been revoked"

  responses:
    BadRequest:
      description: Bad request - invalid input
      headers:
        Content-Type:
          schema:
            type: string
            example: "application/json"
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            missing_text:
              summary: Missing text field
              value:
                code: "BAD_REQUEST"
                message: "Missing required field: text"
            text_too_long:
              summary: Text exceeds maximum length
              value:
                code: "TEXT_TOO_LONG"
                message: "Input text exceeds maximum length of 50,000 characters"
            invalid_json:
              summary: Invalid JSON
              value:
                code: "BAD_REQUEST"
                message: "Invalid JSON in request body"

    Unauthorized:
      description: Invalid or missing API key
      headers:
        Content-Type:
          schema:
            type: string
            example: "application/json"
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            invalid_key:
              summary: Invalid API key
              value:
                code: "INVALID_KEY"
                message: "Invalid or missing API key"
                details: "Check your API key or subscribe to Pro tier"

    RateLimitExceeded:
      description: Rate limit exceeded
      headers:
        Content-Type:
          schema:
            type: string
            example: "application/json"
        Retry-After:
          description: Number of seconds to wait before retrying
          schema:
            type: integer
            example: 3600
        X-RateLimit-Limit:
          description: Request limit per time window
          schema:
            type: integer
            example: 50000
        X-RateLimit-Remaining:
          description: Remaining requests in current window
          schema:
            type: integer
            example: 0
        X-RateLimit-Reset:
          description: Unix timestamp when rate limit resets
          schema:
            type: integer
            example: 1735689600
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            rate_limit:
              summary: Rate limit exceeded
              value:
                code: "RATE_LIMIT"
                message: "Rate limit exceeded"
                details: "You have exceeded your monthly request limit. Please wait until the next billing period or upgrade your plan."

    InternalServerError:
      description: Internal server error
      headers:
        Content-Type:
          schema:
            type: string
            example: "application/json"
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            server_error:
              summary: Internal server error
              value:
                code: "INTERNAL_ERROR"
                message: "An internal server error occurred"
                details: "Please try again later or contact support if the issue persists"

    ServiceUnavailable:
      description: Service temporarily unavailable
      headers:
        Content-Type:
          schema:
            type: string
            example: "application/json"
        Retry-After:
          description: Number of seconds to wait before retrying
          schema:
            type: integer
            example: 60
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            service_unavailable:
              summary: Service unavailable
              value:
                code: "SERVICE_UNAVAILABLE"
                message: "Service temporarily unavailable"
                details: "The service is currently undergoing maintenance. Please try again later."

